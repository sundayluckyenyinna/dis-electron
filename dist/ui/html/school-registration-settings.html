<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> School Registration & Settings </title>
</head>
<body>
    
    <div class="page">
        <!-- Section for the school registration-->
        <fieldset>
            <legend> School Registration </legend>
            <form>
                <section>
                    <label> Name </label>
                    <input type="text" id="school-name" />
                </section>
                <section>
                    <label> Motto </label>
                    <input type="text" id="school-motto" />
                </section>
                <section>
                    <label> Address </label>
                    <input type="text" id="school-address" />
                </section>
                <section>
                    <label> Logo </label>
                    <input type="file" id="school-logo-selector" accept="image/*" />
                    <img src="#" alt="logo" width="150" height="150" id="school-logo-img" />
                </section>
            </form>
        </fieldset>

        <!-- The fieldset for the emails -->
        <fieldset>
            <legend> Email Registration </legend>
            <div class="message">
                This section deals with the registration of electronic mails addresses that will be used by this application in the processing of backups of the school records at the end of the term or session. 
                <div>
                    <ul>
                        <li> Enter at least one email address in the input box below. </li>
                        <li> If the school have multiple email addresses, click the add button shown to enable the entry of multiple addresses.</li>
                        <li> If there be any reason whatsoever to do away with an address, click the trash button next to the specific email address to delete it. </li>
                        <li> Note during back up of the school records to email, <strong> all </strong> the registered email address will be updated of the backup. On this note, therefore, if this is not desired, <i>register only those email to which the backup is desired. </i></li>
                    </ul>
                </div>
                <div>
                    <button id="email-add"> Add </button>
                </div>
                <section class="email-input-section section" id="email-outer-section">
                    <div class="email-input-inner-container">
                        <input type="text" placeholder="Enter email address" class="email-input" />
                        <button class="email-trash trash"> Trash </button>
                    </div>
                </section>

            </div>
        </fieldset>

        <!-- The fieldset for the telephone -->
        <fieldset>
            <legend> Telephone Registration </legend>
            <!-- <div class="message">
                This section deals with the registration of telephonethat will be used by this application in the processing of backups of the school records at the end of the term or session. 
                <div>
                    <ul>
                        <li> Enter at least one email address in the input box below. </li>
                        <li> If the school have multiple email addresses, click the add button shown to enable the entry of multiple addresses.</li>
                        <li> If there be any reason whatsoever to do away with an address, click the trash button next to the specific email address to delete it. </li>
                        <li> Note during back up of the school records to email, <strong> all </strong> the registered email address will be updated of the backup. On this note, therefore, if this is not desired, <i>register only those email to which the backup is desired. </i></li>
                    </ul>
                </div> -->
                <div>
                    <button id="mobile-add"> Add </button>
                </div>
                <section class="mobile-outer-section" id="mobile-section">
                    <div class="mobile-input-inner-container">
                        <input type="number" placeholder="Enter mobile no." class="mobile-input" />
                        <button class="mobile-trash"> Trash </button>
                    </div>
                </section>

            </div>
        </fieldset>

        <div>
            <button id="save"> Save changes </button>
        </div>
    </div>
       
    <script type="text/javascript">

        var exports = {};
        const { ipcRenderer } = require('electron');
        const jQuery = require('jquery');
        let logo = '';

        const $ = jQuery;

        // const schoolData =  getAllSchoolDataFromDataStore();

        // GETTERs And SETTERS
        function getSchoolName () {
            return compressSingly($('#school-name').val().trim(), ' ')
        }

        function setSchoolName ( name ) {
            const schoolData = await getAllSchoolDataFromDataStore();
            $('#school-name').val( name );
        }

        function getSchoolMotto() {
            const mottoInput =  $('#school-motto').val().trim().toString().toLowerCase();
            return mottoInput.charAt(0).toUpperCase() + mottoInput.substring(1);
        }

        function setSchoolMotto( motto ) {
            const schoolData = await getAllSchoolDataFromDataStore();
            $('#school-motto').val( motto );
        }

        function getSchoolAddress() {
            return compressSingly( $('#school-address').val().trim().toString(), ', ');
        }

        function setSchoolAddress( address ) {
            const schoolData = await getAllSchoolDataFromDataStore();
            $('#school-address').val( address )
        };

        function getSchoolLogo () {
            return logo.toString().trim();
        }

        function setSchoolLogo ( logo ){
            const schoolData = await getAllSchoolDataFromDataStore();
            $('#school-logo').val( logo )
        }

        function getAllEmail() {
            const emails = [];
            $('.email-input').each(function(index, element){
                emails.push( $( element ).val().toString().trim() );
            });
            return emails.join('#');
        }

        function getAllMobileNo () {
            const mobiles = [];
            $('.mobile-input').each(function(index, element){
                mobiles.push( $( element ).val().toString().trim() );
            });
            return mobiles.join('#');
        }

        function getAllDataForUpdate(){
            return {
                name : getSchoolName(),
                motto : getSchoolMotto(),
                address : getSchoolAddress(),
                logo : getSchoolLogo(),
                email: getAllEmail(),
                telephone : getAllMobileNo()
            }
        }

        function compressSingly( value, delimiter ) {
            value = value.trim();
            return value.split( delimiter ).filter((token) => token !== '').map((token) => token.charAt(0).toUpperCase() + token.substring(1).toLowerCase()).join( delimiter );
        }

        async function getAllSchoolDataFromDataStore() {
            const datas = await ipcRenderer.invoke('get-school-data-from-data-store');
            return datas;
        };

        // Handler for the addtion of email address
        $('#email-add').on('click', function( event ){
            // create a new email entry section
            const newSection = $('<div/>', { 'class' : 'email-input-inner-container' })
            const input = $('<input/>', { 'class' : 'email-input' });
            input.attr('placeholder', 'Enter email address');
            const trashButton = $('<button/>', { 'class' : 'email-trash trash', 'text' : 'Trash' });
            newSection.append( input, trashButton );
            // append it to the outer section
            $('#email-outer-section').append( newSection );
        });

                // Handler for the addtion of mobile 
            $('#mobile-add').on('click', function( event ){
            // create a new email entry section
            const newSection = $('<div/>', { 'class' : 'mobile-input-inner-container' })
            const input = $('<input/>', { 'class' : 'mobile-input' });
            input.attr('placeholder', 'Enter mobile no.');
            input.attr('type', 'number');
            const trashButton = $('<button/>', { 'class' : 'mobile-trash', 'text' : 'Trash' });
            newSection.append( input, trashButton );
            // append it to the outer section
            $('#mobile-section').append( newSection );
        });

        // Handler for the trash of email address
        $('body').on('click', '.trash', async function( event ){
            const button = $( event.target );

            // // get the corresponding email
            // const emailText = button.parent().find('input').val().trim().toString();

            // // tell the main to ensure that the user really wants to delete the email address.
            // await ipcRenderer.invoke('delete-email', emailText);

            // get the parent div of this button and remove it from the dom
            $( event.target ).parent().remove();
        });

        // Handler for the trash of telephone
        $('body').on('click', '.mobile-trash', async function( event ){
            const button = $( event.target );
            // // get the corresponding email
            // const emailText = button.parent().find('input').val().trim().toString();

            // // tell the main to ensure that the user really wants to delete the email address.
            // await ipcRenderer.invoke('delete-email', emailText);

            // // get the parent div of this button and remove it from the dom
            $( event.target ).parent().remove();
        });

        $('#save').on('click', async function( event ){
            const payload = getAllDataForUpdate();
            // update the database of the school with the new data collected. This is a stateless update.
            await ipcRenderer.invoke('update-school-data', payload );
            // console.log( getAllDataForUpdate() );
        });

        $('#school-logo-selector').on('change', function( event ){
            // get the file selected 
            const imageFile = event.target.files[0];
            console.log( imageFile );
            // Read the base64 string of the file
            const fileReader = new FileReader();

            fileReader.onload = function( event ){
                logo = fileReader.result;
                $('#school-logo-img').attr('src', logo.toString().trim());
            }

            fileReader.readAsDataURL( imageFile );
        });

    </script>
</body>
</html>